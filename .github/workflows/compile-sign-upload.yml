on:
  release:
    types:
      - published
  workflow_dispatch:

name: release

permissions:
  # Needed to access the workflow's OIDC identity.
  id-token: write

  # Needed to upload release assets.
  contents: write

jobs:
  sign-upload:
    name: Build, sign, and upload to Sigstore
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-go@v3
    - name: compile
      run: cd hello-go && go build
    - uses: trailofbits/gh-action-sigstore-python@v0.0.7
      with:
        inputs: hello-go/hello-go
        verify: true
    - name: show
      run: ls && echo "NEXT" && cd hello-go && ls

    # - name: upload artifacts to github
    #   # Confusingly, this action also supports updating releases, not
    #   # just creating them. This is what we want here, since we've manually
    #   # created the release that triggered the action.
    #   uses: softprops/action-gh-release@v1
    #   with:
    #     # dist/ contains the built packages, which smoketest-artifacts/
    #     # contains the signatures and certificates.
    #     files: |
    #       hello-go/
